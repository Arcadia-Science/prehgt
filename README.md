# prehgt: generating a *pre*liminary list of horizontal gene transfer (_HGT_) candidates using compositional and phylogenetic implicit approaches

preHGT a pipeline for lightweight, automated, and scalable approach for pre-screening genomes for horizontal gene transfer (HGT).

TODO: add pipeline overview DAG/figure.

Phylogenetic analysis involving species and gene tree construction are considered the gold standard methods for HGT detection, but these methods are computationally expensive and often don't scale to thousands of genomes.
Given the barrier to scaling, users typically need to know what genomes to include prior to analysis.
The goal of this pipeline is to identify candidate donor and acceptor genomes HGT events that can then be further investigated with tree-based approaches.

We're not picky about capitalization; choose whatever feels right to you (prehgt, preHGT) and feel free to capitalizate at the beginning of a sentence if it brings you joy (PreHGT).

For more scientific details about the preHGT, see [this pub](TODO: add doi link).

## Conceptual overview of the pipeline

This pipeline screens genomes for horizontal gene transfer.

The pipeline begins from a metadata table that records genome accessions and lineages.
The coding domain sequences (`_CDS_from_genomic.fna.gz`) and gene annotation files (`_gff.gz`) are downloaded and then combined (0.9 percent identity threshold) into a genus-level pseudo-pangenome (the clustering is very fast, but doesn't deal with ortholog/paralog problems -- the goal of this approach is not to identify a true pangenome, but to reduce the number of genes that are screened).
Each gene in the pangenome is then screened using composition metrics (codon usage, amino acid usage, etc.).
The results of the composition screen are then parsed to identify HGT candidates (TBD) and to remove likely contaminants (TBD).
The remaining HGT candidates are then BLASTED (DIAMOND) against the NCBI clustered non-redundant database and the results are parsed to identify genes with discrepant lineage matches (exact approach TBD).

## Quick Start

The pipeline is implemented as either a Snakemake or a Nextflow workflow, with environment management with conda.

### Nextflow

### Snakemake

## Additional documentation

### Outputs

The main output of the pipeline is a TSV file summarizing the

Below we provide a description of each column output column.

| Column name                                      | Source     | Definition                                                                                                                                                                                                                                                                                         |
| ------------------------------------------------ | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **genus**                                        | input      | the input genus for a given HGT candidate                                                                                                                                                                                                                                                          |
| **hgt_candidate**                                | pangenome  | HGT candidate gene sequence name. The name is derived from the original FASTA CDS from genomic file downloaded from NCBI and contains the chromosome name, gene number, and GenBank protein ID if it exists. This is also the BLAST query sequence ID.                                             |
| \*\*method                                       | NA         | the method used to infer the HGT candidate. Currently blast, raau (relative amino acid usage), or both                                                                                                                                                                                             |
| **RAAU_cluster**                                 | RAAU       | the cluster that an HGT candidate was in. If multiple HGT candidates are reported for the RAAU method, the cluster might indicate if genes have a similar RAAU (which may indicate shared donor or evolutionary history).                                                                          |
| **blast_algorithm_type**                         | blast      | the BLAST algorithm type used to infer the HGT candidate. One of eith kingdom or sub-kingdom.                                                                                                                                                                                                      |
| **blast_HGT_score**                              | blast      | HGT score inferred from Alien Index. Also reports contamination liklihood. Since Alien index is only calculated for kingdom level transfers, the score will be NA for all sub-kingdom algorithm type results.                                                                                      |
| **blast_hgt_taxonomy_level**                     | blast      | the taxonomic level at which the HGT event was detected (kingdom, phylum, class, order, family)                                                                                                                                                                                                    |
| **blast_acceptor_lineage_at_hgt_taxonomy_level** | blast      | the taxonomic lineage of the acceptor genome up to the HGT level                                                                                                                                                                                                                                   |
| **blast_acceptor_lca_level**                     | blast      | within the acceptor group, what level of taxonomy does the lowest common ancestor occur among all matches? If it’s at the phylum level, the HGT event is probably older than if it’s at the genus level. Or, if the HGT is only observed in two phyla, perhaps the HGT happened twice.             |
| **blast_acceptor_max_pident**                    | blast      | excluding self matches, the maximum percent identity of matches within the acceptor group.                                                                                                                                                                                                         |
| **blast_acceptor_max_bitscore**                  | blast      | excluding self matches, the maximum corrected bitscore of matches within the acceptor group.                                                                                                                                                                                                       |
| **blast_acceptor_min_evalue**                    | blast      | excluding self matches, the minimum evalue of matches within the acceptor group                                                                                                                                                                                                                    |
| **blast_acceptor_num_matches_at_lineage**        | blast      | number of BLAST hits at the acceptor_lineage_at_hgt_taxonomy_level                                                                                                                                                                                                                                 |
| **blast_donor_num_matches_at_lineage**           | blast      | number of BLAST hits at the donor_lineage_at_hgt_taxonomy_level                                                                                                                                                                                                                                    |
| **blast_total_num_matches**                      | blast      | The total number of BLAST hits returned. The maximum is 100, set earlier in the pipeline as the cutoff.                                                                                                                                                                                            |
| **blast_donor_lineage_at_hgt_taxonomy_level**    | blast      | the lineage of the predicted donor group at the hgt_taxonomy_level                                                                                                                                                                                                                                 |
| **blast_donor_best_match_full_lineage**          | blast      | the full taxonomic lineage of the best match at hgt_taxonomy_level                                                                                                                                                                                                                                 |
| **blast_donor_best_match_id**                    | blast      | the sequence ide of the best match at hgt_taxonomy_level                                                                                                                                                                                                                                           |
| **blast_donor_best_match_pident**                | blast      | the percent identity of the best match at hgt_taxonomy_level                                                                                                                                                                                                                                       |
| **blast_donor_max_bitscore**                     | blast      | the maximum corrected bitscore of the best match at hgt_taxonomy_level                                                                                                                                                                                                                             |
| **blast_donor_min_evalue**                       | blast      | the minimum evalue of the best match at hgt_taxonomy_level                                                                                                                                                                                                                                         |
| **blast_alien_index**                            | blast      | a score of HGT probability based on e-value. > 0 possible HGT, >15 likely HGT, >45 highly likely HGT. (kingdom-level only)                                                                                                                                                                         |
| **blast_hgt_index**                              | blast      | a score of HGT probability based on bit score. Basically the same as alien index (kingdom-level only)                                                                                                                                                                                              |
| **blast_donor_distribution_index**               | blast      | within the donor groups, how frequently does the HGT candidate occur in all the donor groups? Is it only seen in bacteria, or is it in bacterial, viruses, and archaea? >0.8 means more specific to a donor group (kingdom-level only)                                                             |
| **blast_entropy**                                | blast      | a measure of the uncertainty or randomness of a set of probabilities (kingdom-level only). Gives a higher number for a qseqid that is evenly distributed across all kingdoms. Gives a lower number for a qseqid that is mostly associated with a single kingdom.                                   |
| **blast_entropy_normalized**                     | blast      | the maximum value occurs when all kingdoms are equally represented. The entropy is -log2(1/K), where K is the number of kingdoms. Given 7 kingdoms, the max entropy would be log2(7). Entropy is normalized to 0-1 range by dividing by the maximum potential value.                               |
| **blast_gini**                                   | blast      | Gini Coefficient, a measure of inequality among values of a frequency distribution (kingdom-level only). A Gini coefficient close to 0 indicates that the qseqid is uniformly distributed across all kingdoms. A Gini coefficient close to 1 indicates that the qseqid is specific to one kingdom. |
| **blast_acceptor_sum_bitscore_per_group_01**     | blast      | The sum of all normalized (0-1) corrected bitscores within the acceptor_lineage_at_hgt_taxonomy_level                                                                                                                                                                                              |
| **blast_donor_sum_bitscore_per_group_01**        | blast      | The sum of all normalized (0-1) corrected bitscores within the donor_lineage_at_hgt_taxonomy_level                                                                                                                                                                                                 |
| **blast_ahs_01_index**                           | blast      | Aggregate hit score index, calculated by subtracting the sum of bitscores in the donor group from the sum of bitscores in the acceptor group when bitscores are 0-1 normalized. Modified from the AvP software.                                                                                    |
| **blast_transfer_index**                         | blast      | Transfer index, calculated from bitscore ratios, taxonomic distances, and rank and total number of BLAST hits. Modified from the HGT-finder software.                                                                                                                                              |
| **blast_transfer_index_p_value**                 | blast      | p value for Transfer index                                                                                                                                                                                                                                                                         |
| **blast_transfer_index_adjusted_p_value**        | blast      | FDR (p < 0.01) for transfer index p value                                                                                                                                                                                                                                                          |
| **kofamscan_ko**                                 | annotation | best KEGG ortholog identifier reported by KofamScan annotation                                                                                                                                                                                                                                     |
| **kofamscan_threshold**                          | annotation | KofamScan HMM threshold; family-specific adaptive score calculated by KofamScan for each KO family.                                                                                                                                                                                                |
| **kofamscan_score**                              | annotation | KofamScan HMM score. We do not filter annotations that do not meet the threshold, as these may still be useful for sleuthing out potential functions of an HGT candidate.                                                                                                                          |
| **kofamscan_evalue**                             | annotation | KofamScan HMM evalue                                                                                                                                                                                                                                                                               |
| **kofamscan_ko_definition**                      | annotation | Full definition for best KEGG ortholog                                                                                                                                                                                                                                                             |
| **hmmscan_domain_name**                          | annotation | domain name for hmmscan hit                                                                                                                                                                                                                                                                        |
| **hmmscan_description**                          | annotation | description of domain for hmmscan hit                                                                                                                                                                                                                                                              |
| **hmmscan_sequence_evalue**                      | annotation | evalu for hmmscan hit                                                                                                                                                                                                                                                                              |
| **hmmscan_sequence_score**                       | annotation | sequence score for hmmscan hit                                                                                                                                                                                                                                                                     |
| **hmmscan_sequence_bias**                        | annotation | sequence bias for hmmscan hit                                                                                                                                                                                                                                                                      |
| **hmmscan_best_domain_evalue**                   | annotation | best domain evalue for hmmscan hit                                                                                                                                                                                                                                                                 |
| **hmmscan_best_domain_score**                    | annotation | best domain score for hmmscan hit                                                                                                                                                                                                                                                                  |
| **pangenome_num_genes_in_cluster**               | pangenome  | total number of genes in the HGT candidate's cluster. Each HGT candidate is the representative sequence for its cluster.                                                                                                                                                                           |
| **pangenome_size**                               | pangenome  | total number of genomes in the genus-level pangenome.                                                                                                                                                                                                                                              |
| **gff_seqid**                                    | GFF file   | sequence ID in the GFF file                                                                                                                                                                                                                                                                        |
| **gff_source**                                   | GFF file   | source in the GFF file                                                                                                                                                                                                                                                                             |
| **gff_feature**                                  | GFF file   | feature annotation (CDS) in the GFF file                                                                                                                                                                                                                                                           |
| **gff_start**                                    | GFF file   | sequence start in the GFF file                                                                                                                                                                                                                                                                     |
| **gff_end**                                      | GFF file   | sequence end in the GFF file                                                                                                                                                                                                                                                                       |
| **gff_score**                                    | GFF file   | score in the GFF file                                                                                                                                                                                                                                                                              |
| **gff_strand**                                   | GFF file   | strand in the GFF file                                                                                                                                                                                                                                                                             |
| **gff_frame**                                    | GFF file   | frame in the GFF file. If a CDS is reported in multiple frames, only one is retained and the total number of frames observed in the original GFF file is reported in the column gff_frame_tally.                                                                                                   |
| **gff_attribute**                                | GFF file   | GFF attribute                                                                                                                                                                                                                                                                                      |
| **gff_seqid_length**                             | GFF file   | Sequence length for a given seqid in a GFF file.                                                                                                                                                                                                                                                   |
| **gff_Dbxref**                                   | GFF file   | GFF Dbxref                                                                                                                                                                                                                                                                                         |
| **gff_gbkey**                                    | GFF file   | GFF GenBank key                                                                                                                                                                                                                                                                                    |
| **gff_gene**                                     | GFF file   | GFF gene name                                                                                                                                                                                                                                                                                      |
| **gff_ID**                                       | GFF file   | GFF ID                                                                                                                                                                                                                                                                                             |
| **gff_locus_tag**                                | GFF file   | GFF locus tag                                                                                                                                                                                                                                                                                      |
| **gff_Name**                                     | GFF file   | GFF name                                                                                                                                                                                                                                                                                           |
| **gff_Note**                                     | GFF file   | GFF note                                                                                                                                                                                                                                                                                           |
| **gff_Parent**                                   | GFF file   | GFF parent ID                                                                                                                                                                                                                                                                                      |
| **gff_product**                                  | GFF file   | GFF protein product                                                                                                                                                                                                                                                                                |
| **gff_protein_id**                               | GFF file   | GFF protein ID                                                                                                                                                                                                                                                                                     |
| **gff_transl_table**                             | GFF file   | GFF translation table                                                                                                                                                                                                                                                                              |
| **gff_frame_tally**                              | GFF file   | total number of frames in which a CDS was observed in the original GFF file. One information for the first frame is retained to reduce reporting redundancy.                                                                                                                                       |

### Full usage

## Citations
